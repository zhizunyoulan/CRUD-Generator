<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="${mapperClass.qualifiedName}">

#if($readDefinition != $null)## A
    <resultMap id="${resultModelClass.simpleName}Map" type="${resultModelClass.qualifiedName}">
        #mybatisResultMapFields( $readDefinition.resultFieldsTree )
    </resultMap>

#end## A
#if($readDefinition != $null)## A
#if($readDefinition.select.tableJoins.size() > 0)## A-1
    <select id="${readDefinition.functionName}" resultMap="${resultModelClass.simpleName}Map">
        select
#foreach ($field in $readDefinition.select.selectFields)## A-1-1
#if( $field.tableAlias != $null )## A-1-1-1
#set( $tableAliasPosition = "${field.tableAlias}." )
#else## A-1-1-1
#set( $tableAliasPosition = "" )
#end## A-1-1-1
#if( $field.selectProperties.columnAlias != $null )## A-1-1-2
#set( $propAliasPosition = " as ${field.selectProperties.columnAlias}" )
#else## A-1-1-2
#set( $propAliasPosition = "" )
#end## A-1-1-2
#if( $foreach.last )## A-1-1-3
#set( $commaPosition = '' )
#else## A-1-1-3
#set( $commaPosition = ',' )
#end## A-1-1-3
            ${tableAliasPosition}${field.columnName}${propAliasPosition}${commaPosition}
#end## A-1-1
        from
#foreach ($tableJoin in $readDefinition.select.tableJoins)## A-1-2
#if( $foreach.first )## A-1-2-1
            ${tableJoin.tableName} as ${tableJoin.tableAlias}
            LEFT JOIN $tableJoin.relatedTableName as ${tableJoin.relatedTableAlias} ON ${tableJoin.tableAlias}.${tableJoin.columnName} = ${tableJoin.relatedTableAlias}.${tableJoin.relatedColumnName}
#else## A-1-2-1
            LEFT JOIN $tableJoin.relatedTableName as ${tableJoin.relatedTableAlias} ON ${tableJoin.tableAlias}.${tableJoin.columnName} = ${tableJoin.relatedTableAlias}.${tableJoin.relatedColumnName}
#end## A-1-2-1
#end## A-1-2
#if( !$readDefinition.select.conditionFields.isEmpty() )## A-1-3
        <where>
#foreach ($field in $readDefinition.select.conditionFields)## A-1-3-1
            #conditionPart( $field true $foreach.first 2 )
#end## A-1-3-1
        </where>
#end## A-1-3
    </select>
#else## A-1
    <select id="${readDefinition.functionName}" resultMap="${resultModelClass.simpleName}Map">
        select
#foreach ($field in $readDefinition.select.selectFields)## A-1-1
#if( $field.selectProperties.columnAlias != $null )## A-1-1-1
#set( $propAliasPosition = " as ${field.selectProperties.columnAlias}" )
#else## A-1-1-1
#set( $propAliasPosition = "" )
#end## A-1-1-1
#if( $foreach.last )## A-1-1-2
#set( $commaPosition = '' )
#else## A-1-1-2
#set( $commaPosition = ',' )
#end## A-1-1-2
            ${field.columnName}${propAliasPosition}${commaPosition}
#end## A-1-1
        from
            ${mainModel.tableName}
#if( !$readDefinition.select.conditionFields.isEmpty() )## A-1-2
        <where>
#foreach ($field in $readDefinition.select.conditionFields)## A-1-2-1
            #conditionPart( $field false $foreach.first 2 )
#end## A-1-2-1
        </where>
#end## A-1-2
    </select>
#end## A-1

#end## A
#if($deleteDefinition != $null && $mainModel.primaryKeyFields.size() > 1)## A
    <delete id="${deleteDefinition.functionName}">
        delete from $mainModel.tableName
        <where>
#foreach($primaryKeyField in $mainModel.primaryKeyFields)## A-1
#if( $foreach.first )## A-1-1
            ${primaryKeyField.columnName} = #{${primaryKeyField.property}}
#else## A-1-1
            AND ${primaryKeyField.columnName} = #{${primaryKeyField.property}}
#end## A-1-1
#end## A-1
        </where>
    </delete>

#end## A
</mapper>
